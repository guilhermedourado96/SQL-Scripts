CREATE VIEW VWDATABASEPROCESSES AS 
SELECT 
DB.NAME						AS BANCO,
R.SESSION_ID				AS SPID,
P.HOSTNAME					AS MAQUINA,
P.PROGRAM_NAME				AS PROGRAMA,
P.LOGINAME					AS USUARIO,
R.COMMAND					AS COMANDO,
R.TRANSACTION_ID			AS ID_TRANSACAO,
R.STATUS					AS STATUS,
R.READS						AS LEITURA,
R.WRITES					AS ESCRITA,
R.ROW_COUNT					AS ROW_COUNT,
R.LOGICAL_READS				AS LEITURA_LOGICA,
T.TEXT						AS SCRIPT,
R.DOP						AS QTD_PARALELISMO,
R.START_TIME				AS HORA_INICIO

FROM SYS.DM_EXEC_REQUESTS R
CROSS APPLY SYS.DM_EXEC_SQL_TEXT(R.SQL_HANDLE) AS T
INNER JOIN SYS.DATABASES DB
ON R.DATABASE_ID = DB.DATABASE_ID

LEFT JOIN SYS.SYSPROCESSES P
ON R.SESSION_ID  = P.SPID

